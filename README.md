# Catalyst smart contracts monorepo
This monorepo contains all Catalyst implementations

Catalyst is an implementation of the Asynchronous Swaps. A design which enables synchronously and asynchronously priced assets using shared liquidity for a large set of assets, supporting both volatile assets and stable assets. The design allows market markers to compete with exiting (volatile and stable coin) on-chain AMMs and (volatile and stable coin) cross-chain AMMs using the same amount of liquidity as a single competitor.


Each implementation is contained within its own folder.
  - /evm : Solidity implementation targeting the Ethereum Virtual Machine.
  - /rust-common : Contains depreciated code
  - /simulator : Simulation of the Catalyst logic.
  - /solana : Rust implementation targeting the Solana Virtual Machine.

## Dev dependencies

- ganache-cli

  - `pnpm install -g ganache`

- eth-brownie

  - via [poetry](https://python-poetry.org)  (`brew install poetry`): `poetry install` in `/`
  - via pip: `pip3 install eth-brownie` (check that your $PATH is properly configured).

- Python dependencies in *./pyproject.toml*. Automatically installed with `poetry install`
  - Note: You can set the poetry python version via `poetry env use python3.9` for example.

- Blockchain API

  - Default: [alchemy](https://www.alchemy.com), export key to `$ALCHEMY_API_TOKEN`

  - Alt: [Infura](https://infura.io), edit *./.brownie/network-config.yaml* with Infura RPC.

# Introduction to Brownie & EVM Smart Contracts

Brownie wraps smart contract development in a neat package. For this repository, any smart contract written in Solidity or Vyper will automatically be compiled and deploy-ready. To deploy, fund an account loaded into Brownie:

- `brownie accounts --help`

  - `brownie accounts new <NAME OF ACCOUNT>`

    - Example: `brownie accounts new deployment` or `brownie accounts new 0` and provide a privatekey.

  - `brownie generate new <NAME OF ACCOUNT>`

- Fund the account generated by brownie. [Kovan faucet](https://github.com/kovan-testnet/faucet), [Rinkeby faucet](https://faucet.rinkeby.io).

Open the brownie dev console:

`brownie console --network <mainnet/kovan/development>`

and load the account:

```
acct = accounts.load('<NAME OF ACCOUNT>')
SC = SmartContractName.deploy(*init_vars, {'from': acct})
SC
```

The smart contract has now been deployed. Deployment scripts can be found in `./scripts/deploy/*`

# Contracts

Contracts are stored in *./contracts*. Contracts compiled by brownie, `brownie compile` are stored in *./build*. Brownie will automatically download compatible solidity and vyper versions for internal usage.

### Solidity

To compile solidity contracts directly (not through Brownie), one has to install:

- Solidity

  - via brew: `brew tap ethereum/ethereum` then `brew install solidity`
  - via npm: `pnpm install -g solc` (installs solcjs)
  - [soliditylang.org](https://docs.soliditylang.org/en/latest/installing-solidity.html)

- `pnpm install`

- `solc <path-to-contract> --base-path node_modules`

### Vyper

To compile vyper contracts directly, the correct Vyper version should be installed independently of this project. eth-brownie depends on the newest version of Vyper, which the contracts might not be compatible with.

- Vyper
  - via pip: `pip install vyper==<version>`
  - via docker: [vyper.readthedocs.io](https://vyper.readthedocs.io/en/latest/installing-vyper.html#docker)

# Connecting to devnet
The VPS does not expose **geth**, so to connect one has to execute the commands on the VPS's localhost.

The easiest way to achieve this is via ssh port forwarding. To connect localhost on port 10000 (geth) execute:

> ssh -f -N -L 10000:localhost:10000 root@143.198.168.233 

and to connect localhost on port 10001 (bsc_geth) execute:

> ssh -f -N -L 10001:localhost:10001 root@143.198.168.233

All networking connections sent to port 10000 and 10001 will be sent to the VPS's localhost on the respective ports.

Then add the 2 networks to brownie:

> brownie networks add Ethereum polymerase-geth  host=http://127.0.0.1:10000 chainid=1337

> brownie networks add 'Binance Smart Chain' polymerase-bsc-geth  host=http://127.0.0.10001 chainid=1234